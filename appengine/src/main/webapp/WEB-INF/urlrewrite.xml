<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 2.6//EN" "http://www.tuckey.org/res/dtds/urlrewrite2.6.dtd">
<urlrewrite>

	<!-- rewrite appengine paths exactly as requested -->
	<rule>
		<from>^/_ah/(.*)</from>
		<to last="true">/_ah/$1</to>
	</rule>

	<!-- rewrite api paths exactly as requested -->
	<rule>
		<from>^/api/v0/(.*)</from>
		<to last="true">/api/v0/$1</to>
	</rule>
	<rule>
		<from>^/api/v1/(.*)</from>
		<to last="true">/api/v1/$1</to>
	</rule>

	<!-- spider crawler robots -->
	<rule>
		<method>GET</method>
		<condition name="user-agent">(bot|spider|snippet|pinterest|crawler|archiver|flipboardproxy|mediapartners|facebookexternalhit|quora|disqus)</condition>
		<from>.*</from>
		<set type="status">404</set>
		<to last="true">null</to>
	</rule>

	<!-- angular routes -->
	<rule>
		<condition type="remote-addr" operator="notequal" next="and">^208\.111\.48\.</condition><!-- wiz hnl -->
		<condition type="remote-addr" operator="notequal" next="and">^208\.111\.52\.</condition><!-- wiz tokyo -->
		<condition type="remote-addr" operator="notequal" next="and">^43\.233\.13\.</condition><!-- tokyo office -->
		<condition type="remote-addr" operator="notequal" next="and">^76\.173\.255\.</condition><!-- taesup -->
		<condition type="remote-addr" operator="notequal" next="and">^219\.164\.103\.</condition><!-- nikuhodai -->
		<condition type="remote-addr" operator="notequal" next="and">^77\.145\.35\.</condition><!-- paris demo -->
		<condition type="remote-addr" operator="notequal" next="and">^73\.148\.56\.</condition><!-- chris -->
		<condition type="remote-addr" operator="notequal" next="and">^2601:5cc:0:41f8:</condition><!-- chris -->
		<condition type="remote-addr" operator="notequal" next="and">^72\.83\.163\.</condition><!-- paul -->
		<condition type="remote-addr" operator="notequal" next="and">^24\.224\.221\.</condition><!-- reg -->
		<condition type="remote-addr" operator="notequal">^127\.</condition>
		<from>.*</from>
		<set type="status">403</set>
		<to last="true">null</to>
	</rule>

	<!-- customer control panel, requires valid session -->
	<rule>
		<from>^/user/upgrade(.*)</from>
		<to last="true">/user/upgrade.html$1</to>
	</rule>
	<rule>
		<from>^/user(.*)</from>
		<to last="true">/user/user.html$1</to>
	</rule>

	<!-- public marketing content -->
	<rule>
		<from>^/confirm(.*)</from>
		<to last="true">/confirmation.html$1</to>
	</rule>
	<rule>
		<from>^/download(.*)</from>
		<to last="true">/download.html$1</to>
	</rule>
	<rule>
		<from>^/join(.*)</from>
		<to last="true">/join.html$1</to>
	</rule>
	<rule>
		<from>^/login(.*)</from>
		<to last="true">/login.html$1</to>
	</rule>
	<rule>
		<from>^/reset(.*)</from>
		<to last="true">/reset.html$1</to>
	</rule>
	<rule>
		<from>^/signup(.*)</from>
		<to last="true">/signup.html$1</to>
	</rule>
	<rule>
		<from>^/home(.*)</from>
		<to last="true">/cypherpunk-public.html$1</to>
	</rule>

	<!-- public root -->
	<rule>
		<from>^/$</from>
		<to last="true">/cypherpunk-public.html</to>
	</rule>

	<!-- catchall handler -->
	<rule>
		<from>.*</from>
		<set type="status">404</set>
		<to last="true">null</to>
	</rule>

</urlrewrite>
